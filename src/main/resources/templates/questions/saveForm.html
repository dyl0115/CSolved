<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>질문 등록</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.5/cdn.min.js"></script>
        <style>
            .tag-item {
                display: inline-block;
                padding: 4px 12px;
                margin: 4px;
                background-color: #e3f2fd;
                border-radius: 12px;
                font-size: 12px;
            }

            .markdown-guide {
                background-color: #f8f9fa;
                padding: 15px;
                border-radius: 4px;
                margin: 15px 0;
            }

            .btn-round {
                border-radius: 20px;
            }
        </style>
    </head>
    <body class="bg-light">
        <!-- 네비게이션 바 -->
        <div th:replace="~{fragments/navigation :: navigationBar}"></div>
        
        <div class="container mt-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title mb-4">CS 질문 등록</h2>
                    
                    <form th:action="@{/questions/create}" method="post" th:object="${questionSaveForm}">
                        <div class="row mb-3">
                            <!-- 카테고리 선택 -->
                            <div class="col-md-3">
                                <label for="categoryList">카테고리</label>
                                <select class="form-select" id="categoryList" th:field="*{categoryList}">
                                    <option th:each="category : ${availableCategories}" th:value="${category.id}"
                                            th:text="${category.name}"></option>
                                </select>
                            </div>
                            
                            태그 입력
                            <div class="col-md-9">
                                <label for="tags" class="form-label">태그</label>
                                <div class="input-group" id="tags">
                                    <input type="text" class="form-control" id="tagInput" placeholder="태그를 입력하세요">
                                    <button class="btn btn-outline-secondary" type="button" onclick="addTag()">추가
                                    </button>
                                </div>
                                <!--                                <div id="tagContainer" class="mt-2">-->
                                <!--                                    <input type="hidden" th:field="*{tags}">-->
                                <!--                                    &lt;!&ndash; 태그들이 여기에 동적으로 추가됩니다 &ndash;&gt;-->
                                <!--                                </div>-->
                            </div>
                        </div>
                        
                        <!-- 제목 입력 -->
                        <div class="mb-3">
                            <label for="title" class="form-label">제목</label>
                            <input type="text" class="form-control" id="title" th:field="*{title}" required>
                        </div>
                        
                        <!-- 내용 입력 -->
                        <div class="mb-3">
                            <label for="content" class="form-label">내용</label>
                            <textarea class="form-control" id="content" th:field="*{content}" rows="12"
                                      required></textarea>
                        </div>
                        
                        <!-- 마크다운 가이드 -->
                        <div class="markdown-guide">
                            <small class="text-muted">
                                <div>마크다운을 지원합니다. ## 제목, * 목록, ``` 코드블록 등을 사용할 수 있습니다.</div>
                                <div>코드나 이미지를 첨부할 수 있습니다.</div>
                            </small>
                        </div>
                        
                        <!-- 버튼 영역 -->
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary btn-round px-4"
                                    onclick="saveDraft()">
                                임시저장
                            </button>
                            <button type="submit" class="btn btn-primary btn-round px-4">
                                등록
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <script>
            function addTag() {
                const tagInput = document.getElementById('tagInput');
                const tagContainer = document.getElementById('tagContainer');
                const tagsField = document.querySelector('input[name="tags"]');

                if (tagInput.value.trim() !== '') {
                    const tagSpan = document.createElement('span');
                    tagSpan.className = 'tag-item';
                    tagSpan.textContent = tagInput.value;

                    // 삭제 버튼 추가
                    const deleteBtn = document.createElement('span');
                    deleteBtn.innerHTML = ' &times;';
                    deleteBtn.style.cursor = 'pointer';
                    deleteBtn.onclick = function () {
                        tagSpan.remove();
                        updateTagsField();
                    };

                    tagSpan.appendChild(deleteBtn);
                    tagContainer.appendChild(tagSpan);

                    // hidden input 업데이트
                    updateTagsField();

                    tagInput.value = '';
                }
            }

            function updateTagsField() {
                const tags = Array.from(document.querySelectorAll('.tag-item'))
                    .map(tag => tag.textContent.replace(' ×', ''));
                document.querySelector('input[name="tags"]').value = tags.join(',');
            }

            function saveDraft() {
                // 임시저장 로직 구현
                const formData = new FormData(document.querySelector('form'));
                // localStorage나 서버에 임시저장 구현
                alert('임시저장되었습니다.');
            }
        </script>
    </body>
</html>